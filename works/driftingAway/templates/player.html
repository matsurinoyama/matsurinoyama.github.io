<!doctype html>
<html lang="ja">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>離れていく — Player {{ player_id }}</title>
    <link rel="stylesheet" href="/static/css/styles.css?v={{ cache_bust }}" />
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=IBM+Plex+Sans+JP:wght@200;400;600&family=New+Tegomin&display=swap"
      rel="stylesheet"
    />
  </head>
  <body data-player-id="{{ player_id }}">
    <!-- ── Timer (top-center, only visible during conversation) ──── -->
    <div id="timer" class="timer">3:00</div>

    <!-- ── IDLE ────────────────────────────────────────────────────── -->
    <div class="screen screen--player" data-phase="idle">
      <div class="idle-screen">
        <h1>離れていく</h1>
        <p>イヤーマフを着けてください</p>
        <p class="idle-instruction">準備ができたらボタンを押してください</p>
      </div>
    </div>

    <!-- ── WAITING ─────────────────────────────────────────────────── -->
    <div class="screen screen--player" data-phase="waiting" hidden>
      <div class="idle-screen">
        <h1>準備完了！</h1>
        <p id="waiting-text">
          もう一人のプレイヤーを待っています<span class="waiting-dots"></span>
        </p>
      </div>
    </div>

    <!-- ── PROMPT SELECT ───────────────────────────────────────────── -->
    <div class="screen screen--player" data-phase="prompt_select" hidden>
      <div class="prompt-select">
        <div class="prompt-cards" id="prompt-cards"></div>
      </div>
    </div>

    <!-- ── CONVERSATION ────────────────────────────────────────────── -->
    <div class="screen screen--player" data-phase="conversation" hidden>
      <div class="conversation">
        <div class="messages" id="messages"></div>
        <div class="ptt-bar">
          <span class="ptt-label" id="ptt-label"
            >長押しで話す <span class="ptt-dot" id="ptt-dot"></span
          ></span>
        </div>
      </div>
    </div>

    <!-- ── REVEAL ──────────────────────────────────────────────────── -->
    <div class="screen screen--player" data-phase="reveal" hidden>
      <div class="reveal">
        <h2>終了！</h2>
        <div id="reveal-body"></div>
      </div>
    </div>

    <!-- ── RESET ───────────────────────────────────────────────────── -->
    <div class="screen screen--player" data-phase="reset" hidden>
      <div class="idle-screen">
        <h1>お疲れさまでした！</h1>
        <p>次のラウンドを準備中<span class="waiting-dots"></span></p>
      </div>
    </div>

    <!-- ── MIC SETUP OVERLAY (shown once on first load) ────────── -->
    <div class="mic-setup" id="mic-setup">
      <div class="mic-setup-card">
        <h2>🎙 マイクの設定</h2>
        <p class="mic-setup-sub">
          プレイヤー{{ player_id }}のマイクを選択してください
        </p>
        <div id="mic-list" class="mic-list">
          <p class="mic-loading">マイクへのアクセスを要求中…</p>
        </div>
        <div class="mic-setup-actions">
          <button class="btn" id="mic-test-btn" disabled>🔊 テスト</button>
          <button class="btn" id="mic-confirm-btn" disabled>✓ 確認</button>
        </div>
        <p class="mic-setup-hint">
          この設定はこのブラウザに保存されます。変更するには/player/{{ player_id
          }}を再度開いてください。
        </p>
      </div>
    </div>

    <script src="/static/js/i18n.js?v={{ cache_bust }}"></script>
    <script src="/static/js/common.js?v={{ cache_bust }}"></script>
    <script src="/static/js/audio.js?v={{ cache_bust }}"></script>
    <script src="/static/js/whitenoise.js?v={{ cache_bust }}"></script>
    <script src="/static/js/player.js?v={{ cache_bust }}"></script>
  </body>
</html>
